<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: dawg/compressor.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: dawg/compressor.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* See README.md at the root of this distribution for copyright and
   license information */

/* eslint-env node */

/**
 * Command-line program to generate a DAWG (Directed Acyclic Word Graph) from a
 * word lexicon. Generates a somewhat optimised Trie, encodes it in
 * an integer array, which it then gzips.
 *
 * Based on Appel &amp; Jacobsen, with ideas from Weck and Toal. Not the
 * fastest, or the most efficient, but who cares? It works.
 *
 * `node js/dawg/compressor.js` will tell you how to use it.
 * @module
 */

const requirejs = require('requirejs');

requirejs.config({
	baseUrl: `${__dirname}/../..`,
	paths: {
		dawg: `js/dawg`
	}
});

requirejs(['fs-extra', 'node-gzip', 'dawg/Trie'], (Fs, Gzip, Trie) => {
	const DESCRIPTION = [
		'USAGE',
		`node ${process.argv[1].replace(/.*\//, '')} &lt;lexicon> &lt;outfile>`,
		'Create a directed acyclic word graph (DAWG) from a list of words.',
		'&lt;lexicon> is a text file containing a list of words, and &lt;outfile>',
		'is the binary file containing the compressed DAWG, as used by the',
		'Dictionary.js module.' ];

	if (process.argv.length &lt; 4) {
		console.log(DESCRIPTION.join('\n'));
		return;
	}

	const infile = process.argv[2];
	const outfile = process.argv[3];

	Fs.readFile(infile)
	.then(async function(data) {
		const lexicon = data
			.toString()
			.toUpperCase()
			.split(/\r?\n/)
			.map(w => w.replace(/[\W].*$/, '')) // comments
			.sort();

		// First step; generate a Trie from the words in the lexicon
		const trie = new Trie(lexicon);

		// Second step; generate a graph from the tree
		trie.generateDAWG();
		
		// We have a DAWG. We could output it now like this:
		//console.log(JSON.stringify(trie.first.simplify(), null, ' '));

		// Instead we want to generate an integer array for use with Dictionary
		const dawg = trie.encodeDAWG();

		// Pack the array of encoded integers into an ArrayBuffer
		const buffer = new ArrayBuffer(dawg.length * 4);
		const dv = new DataView(buffer);
		for (let i = 0; i &lt; dawg.length; i++) {
			dv.setUint32(i * 4, dawg[i]); // Little endian
		}
		console.log(`Uncompressed ${dawg.length * 4} bytes`);

		const z = await Gzip.gzip(dv);
		console.log(`Compressed ${z.length} bytes`);

		// Write DAWG binary bytes
		return Fs.writeFile(outfile, z)
		.then(() => console.log(`Wrote DAWG to ${outfile}`));
	})
	.catch(e => {
		console.log(e.toString());
		console.log(DESCRIPTION.join('\n'));
	});
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-dawg_compressor.html">dawg/compressor</a></li><li><a href="module-dawg_explore.html">dawg/explore</a></li><li><a href="module-design_valett.html">design/valett</a></li><li><a href="module-game_findBestPlay.html">game/findBestPlay</a></li><li><a href="module-i18n_checkTranslation.html">i18n/checkTranslation</a></li></ul><h3>Classes</h3><ul><li><a href="Board.html">Board</a></li><li><a href="BrowserPlatform.html">BrowserPlatform</a></li><li><a href="Database.html">Database</a></li><li><a href="Dictionary.html">Dictionary</a></li><li><a href="Edition.html">Edition</a></li><li><a href="FileDatabase.html">FileDatabase</a></li><li><a href="Fridge.html">Fridge</a></li><li><a href="Game.html">Game</a></li><li><a href="I18N.html">I18N</a></li><li><a href="LetterBag.html">LetterBag</a></li><li><a href="Move.html">Move</a></li><li><a href="Platform.html">Platform</a></li><li><a href="Player.html">Player</a></li><li><a href="Rack.html">Rack</a></li><li><a href="Server.html">Server</a></li><li><a href="ServerPlatform.html">ServerPlatform</a></li><li><a href="Square.html">Square</a></li><li><a href="Surface.html">Surface</a></li><li><a href="Tile.html">Tile</a></li><li><a href="Trie.html">Trie</a></li><li><a href="TrieNode.html">TrieNode</a></li><li><a href="Turn.html">Turn</a></li><li><a href="Ui.html">Ui</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sat Oct 30 2021 08:44:36 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
